<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password Generator</title>
    <link rel="stylesheet" href="output.css" />
    <script src="script.js"></script>
  </head>
  <body class="flex flex-col items-center min-w-fit">
    <nav
      id="navigation"
      class="flex w-full gap-5 pt-2 px-4 sm:px-8 lg:justify-center bg-white shadow"
    >
      <a href="./password.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-b-blue-700"
        >
          <img
            class="max-w-8 max-h-8"
            src="icon/dice-five.svg"
            alt="Password"
          />
          <h2 class="text-base font-medium sm:block">Password</h2>
        </div>
      </a>
      <a href="./passphrase.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img class="max-w-8 max-h-8" src="icon/text.svg" alt="Passphrase" />
          <h2 class="text-base font-medium hidden sm:block">Passphrase</h2>
        </div>
      </a>
      <a href="./domain.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img class="max-w-8 max-h-8" src="icon/globe.svg" alt="Domain" />
          <h2 class="text-base font-medium hidden sm:block">Domain</h2>
        </div>
      </a>
      <a href="./tester.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img
            class="max-w-8 max-h-8"
            src="icon/check-circle.svg"
            alt="Tester"
          />
          <h2 class="text-base font-medium hidden sm:block">Tester</h2>
        </div>
      </a>
      <a href="./storage.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img class="max-w-8 max-h-8" src="icon/lock.svg" alt="Storage" />
          <h2 class="text-base font-medium hidden sm:block">Storage</h2>
        </div>
      </a>
    </nav>

    <div id="content" class="flex flex-col p-4 sm:p-8 max-w-6xl">
      <h1 class="text-2xl sm:text-3xl text-blue-700 font-light">
        Password generator
      </h1>
      <p class="pt-2 font-medium text-gray-700">
        A password generator is a tool that automatically creates strong, random
        passwords for users. By combining letters, numbers, and symbols it can
        create strong passwords that are hard to guess or crack.
        <br /><br />
        This password generator will automatically check for password strength
        and for matches in known data-breaches.
      </p>

      <hr class="my-6 text-gray-300" />

      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Password length</h2>
          <p class="text-gray-500">Choose a total length for your password.</p>
        </div>
        <label class="relative inline-flex items-center">
          <input
            id="passwordLength"
            type="number"
            class="flex max-w-14 pl-2 py-1.5 text-center border border-gray-500 rounded-md focus-within:outline-blue-600"
            placeholder="0"
            value="14"
          />
        </label>
      </div>

      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Lowercase</h2>
          <p class="text-gray-500">
            Use lowercase characters when generating your password.
          </p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="toggleLowercase"
            type="checkbox"
            value=""
            class="sr-only peer"
          />
          <div
            class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"
          ></div>
        </label>
      </div>

      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Uppercase</h2>
          <p class="text-gray-500">Include uppercase characters.</p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="toggleUppercase"
            type="checkbox"
            value=""
            class="sr-only peer"
          />
          <div
            class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"
          ></div>
        </label>
      </div>

      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Numbers</h2>
          <p class="text-gray-500">Include random numbers.</p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="toggleNumbers"
            type="checkbox"
            value=""
            class="sr-only peer"
          />
          <div
            class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"
          ></div>
        </label>
      </div>

      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Symbols</h2>
          <p class="text-gray-500">
            Add a mixture of symbols to your password.
          </p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="toggleSymbols"
            type="checkbox"
            value=""
            class="sr-only peer"
          />
          <div
            class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"
          ></div>
        </label>
      </div>

      <hr class="mt-4 mb-6 text-gray-300" />

      <div class="flex">
        <div
          id="passwordText"
          class="flex w-full sm:justify-center p-1.5 border border-blue-500 text-gray-300 rounded-l-md"
        >
          Generated Password
        </div>
        <div
          id="passwordBox"
          class="flex items-center px-3 border-l-0 border border-blue-500 rounded-r-md"
        >
          <span
            id="passwordIcon"
            class="flex items-center justify-center w-5 h-5 bg-blue-500 text-white text-xs font-bold font-mono rounded-full pointer-events-none"
          >
            <img class="w-4 h-4" src="icon/check.svg" />
          </span>
        </div>
      </div>

      <div
        id="errorDisplay"
        class="hidden items-center gap-4 p-5 mt-4 rounded-md"
      >
        <img id="errorIcon" class="w-8 h-8" src="icon/error.svg" />
        <div id="errorDescription"></div>
      </div>

      <div class="flex justify-center mt-4">
        <button
          id="generateButton"
          onclick="generate();"
          class="flex justify-center py-2 px-4 sm:min-w-80 gap-2 bg-blue-700 text-white font-semibold hover:bg-blue-600 rounded-md cursor-pointer"
        >
          Generate
          <img class="w-6 h-6" src="icon/reload.svg" />
        </button>
      </div>
    </div>

    <script src="display.js"></script>
    <script>
      // Settings
      const passwordLength = document.getElementById('passwordLength')
      const toggleLowercase = document.getElementById('toggleLowercase')
      const toggleUppercase = document.getElementById('toggleUppercase')
      const toggleNumbers = document.getElementById('toggleNumbers')
      const toggleSymbols = document.getElementById('toggleSymbols')

      // Automatic generation on change
      passwordLength.addEventListener('change', generate)
      toggleLowercase.addEventListener('change', generate)
      toggleUppercase.addEventListener('change', generate)
      toggleNumbers.addEventListener('change', generate)
      toggleSymbols.addEventListener('change', generate)

      // Password Copy
      document.getElementById('passwordText').addEventListener('click', () => {
        password = passwordText.innerText
        if (
          password != 'Generated Password' &&
          password != 'Copied to the Clipboard'
        ) {
          passwordText.innerText = 'Copied to the Clipboard'
          copyToClipboard(password)
          setTimeout(() => {
            passwordText.innerText = password
          }, 700)
        }
      })

      async function generate() {
        let selection = ''
        let password = ''

        // Load user settings.
        if (toggleLowercase.checked) {
          selection += charset['lower']
          password += randChoice(charset['lower'])
        }
        if (toggleUppercase.checked) {
          selection += charset['upper']
          password += randChoice(charset['upper'])
        }
        if (toggleNumbers.checked) {
          selection += charset['number']
          password += randChoice(charset['number'])
        }
        if (toggleSymbols.checked) {
          selection += charset['symbol']
          password += randChoice(charset['symbol'])
        }

        // Error management and display.
        let description = []
        // Check for generation errors
        if (!selection.length) {
          description.push('• Please select at least one character set.')
        }
        if (
          passwordLength.value <= 0 ||
          passwordLength.value < password.length
        ) {
          description.push(
            '• Your password is not long enought to fit the requirements.'
          )
        }
        if (description.length) {
          setError('icon/error.svg', 'red', 'Error:', description)
          setPassword(description.length, 'red', 'Generated Password')
          return
        }

        // Password generation.
        while (password.length < passwordLength.value) {
          password += randChoice(selection)
        }

        // Check strength & safety
        if (checkEntropy_charset(password) < 76) {
          description.push('• Password strength: Low.')
        } else {
          // Check the API only when the entropy is high enough to
          // avoid sending too many queries to ihavebeenpwned
          if ((await checkPwned(password)) > 0) {
            description.push('• This password has been found in a breach.')
          }
        }

        // Password display.
        if (description.length) {
          setError('icon/warning.svg', 'yellow', 'Warning:', description)
          setPassword(description.length, 'yellow', password)
        } else {
          setError('icon/success.svg', 'green', 'Password generated.', [
            '• Password strength: High.',
            '• No breaches found.',
          ])
          setPassword(0, 'blue', password)
        }
      }
    </script>
  </body>
</html>
