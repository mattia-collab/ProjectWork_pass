<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password Generator</title>
    <!-- Scripts -->
    <script src="script/main.js"></script>
    <script src="script/displayerror.js"></script>
    <script src="script/w20000.js"></script>
    <!-- Style -->
    <link rel="stylesheet" href="output.css" />
  </head>

  <body class="flex flex-col items-center min-w-fit">
    <nav
      id="navigation"
      class="flex lg:justify-center flex-row w-full gap-5 pt-2 px-4 sm:px-8 bg-white shadow"
    >
      <a href="./password.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img
            class="max-w-8 max-h-8"
            src="icon/dice-five.svg"
            alt="Randomized"
          />
          <h2 class="text-base font-medium hidden sm:block">Password</h2>
        </div>
      </a>
      <a href="./passphrase.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-b-blue-700"
        >
          <img class="max-w-8 max-h-8" src="icon/text.svg" alt="Domain" />
          <h2 class="text-base font-medium sm:block">Passphrase</h2>
        </div>
      </a>
      <a href="./domain.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img class="max-w-8 max-h-8" src="icon/globe.svg" alt="Domain" />
          <h2 class="text-base font-medium hidden sm:block">Domain</h2>
        </div>
      </a>
      <a href="./tester.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img
            class="max-w-8 max-h-8"
            src="icon/check-circle.svg"
            alt="Domain"
          />
          <h2 class="text-base font-medium hidden sm:block">Tester</h2>
        </div>
      </a>
      <a href="./storage.html">
        <div
          class="flex shrink-0 gap-2 items-center cursor-pointer py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-b-gray-500"
        >
          <img class="max-w-8 max-h-8" src="icon/lock.svg" alt="Domain" />
          <h2 class="text-base font-medium hidden sm:block">Storage</h2>
        </div>
      </a>
    </nav>

    <!-- Description -->
    <div id="content" class="flex flex-col p-4 sm:p-8 max-w-6xl">
      <h1 class="text-2xl sm:text-3xl text-blue-700 font-light">
        Passphrase generator
      </h1>
      <p class="font-medium text-gray-700 pt-2">
        A passphrase is a sequence of random words or a short sentence used as a
        password. Unlike traditional passwords, passphrases are longer but
        easier to remember, making them both more secure and user-friendly.
        <br /><br />
        This generator will automatically check for password strength and for
        matches in known data-breaches.
      </p>

      <hr class="my-6 text-gray-300" />
      <!-- Separator style -->
      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Separator style</h2>
          <p class="text-gray-500">Select the word separator.</p>
        </div>
        <label class="relative inline-flex items-center">
          <select
            id="passwordSeparator"
            name="separator"
            class="flex px-3 py-1.5 border border-gray-500 rounded-md focus-within:outline-blue-600"
          >
            <option value="-">Dash</option>
            <option value="_">Underscore</option>
            <option value=" ">Space</option>
            <option value="">None</option>
          </select>
        </label>
      </div>
      <!-- Word length -->
      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Word length</h2>
          <p class="text-gray-500">
            Choose the word-length of your passphrase.
          </p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="passwordLength"
            name="length"
            type="number"
            value="4"
            placeholder="0"
            class="flex max-w-14 pl-2 py-1.5 text-center border border-gray-500 rounded-md focus-within:outline-blue-600"
          />
        </label>
      </div>
      <!-- Capital letter toggle -->
      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Capital letter</h2>
          <p class="text-gray-500">Set the first letter to Uppercase.</p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="toggleCapital"
            type="checkbox"
            value=""
            class="sr-only peer"
          />
          <div
            class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"
          ></div>
        </label>
      </div>
      <!-- All caps toggle -->
      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Allcaps</h2>
          <p class="text-gray-500">Set every letter to UPPERCASE.</p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="toggleAllcaps"
            type="checkbox"
            value=""
            class="sr-only peer"
          />
          <div
            class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"
          ></div>
        </label>
      </div>
      <!-- Leet Speak toggle -->
      <div class="flex items-center justify-between gap-4 px-4 mb-4">
        <div>
          <h2 class="font-semibold text-gray-900">Leet speak</h2>
          <p class="text-gray-500">0nly f0r tru3 h4xx0rs.</p>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input
            id="toggleLeet"
            type="checkbox"
            value=""
            class="sr-only peer"
          />
          <div
            class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full peer-checked:after:border-white"
          ></div>
        </label>
      </div>
      <hr class="mt-4 mb-6 text-gray-300" />
      <!-- Password display -->
      <div class="flex">
        <div
          id="passwordText"
          onclick="copyPassword()"
          class="flex w-full sm:justify-center p-1.5 border border-blue-600 text-gray-300 rounded-tl-md"
        >
          Generated Passphrase
        </div>
        <div
          id="passwordBox"
          class="flex items-center px-3 border-l-0 border border-blue-600 rounded-tr-md"
        >
          <span
            id="passwordIcon"
            class="flex items-center justify-center w-5 h-5 bg-blue-500 text-white text-xs font-bold font-mono rounded-full pointer-events-none"
          >
            <img class="w-4 h-4" src="icon/check.svg" />
          </span>
        </div>
      </div>
      <!-- Hash display -->
      <div class="flex flex-row">
        <input
          disabled
          id="SHA256"
          value="SHA-256"
          class="flex w-full sm:justify-center p-1.5 border border-blue-600 text-gray-300 rounded-bl-md border-t-0"
        />
        <input
          disabled
          id="SHA512"
          value="SHA-512"
          class="flex w-full sm:justify-center p-1.5 border border-blue-600 text-gray-300 rounded-br-md border-t-0 border-l-0"
        />
      </div>
      <!-- Error display -->
      <div
        id="errorDisplay"
        class="hidden items-center gap-4 p-5 mt-4 rounded-md"
      >
        <img id="errorIcon" class="w-8 h-8" src="icon/error.svg" />
        <div id="errorDescription"></div>
      </div>
      <!-- Generate Button -->
      <div class="flex justify-center mt-4">
        <button
          id="generateButton"
          onclick="generatePassphrase();"
          class="flex justify-center py-2 px-4 sm:min-w-80 gap-2 bg-blue-700 text-white font-semibold hover:bg-blue-600 rounded-md cursor-pointer"
        >
          Generate
          <img class="w-6 h-6" src="icon/reload.svg" />
        </button>
      </div>
    </div>

    <script>
      // Settings
      const passwordSeparator = document.getElementById("passwordSeparator");
      const passwordLength = document.getElementById("passwordLength");
      const toggleCapital = document.getElementById("toggleCapital");
      const toggleAllcaps = document.getElementById("toggleAllcaps");
      const toggleLeet = document.getElementById("toggleLeet");

      // Automatic generation on change
      passwordSeparator.addEventListener("change", generatePassphrase);
      passwordLength.addEventListener("change", generatePassphrase);
      toggleCapital.addEventListener("change", generatePassphrase);
      toggleAllcaps.addEventListener("change", generatePassphrase);
      toggleLeet.addEventListener("change", generatePassphrase);

      // Password Copy
      function copyPassword() {
        const passwordText = document.getElementById("passwordText");
        const password = passwordText.innerText;
        if (
          password != "Generated Password" &&
          password != "Copied to the Clipboard"
        ) {
          passwordText.innerText = "Copied to the Clipboard";
          copyToClipboard(password);
          setTimeout(() => {
            passwordText.innerText = password;
          }, 700);
        }
      }

      // Passphrase Generation
      async function generatePassphrase() {
        let separator = passwordSeparator.value;
        let wordlength = passwordLength.value;
        let password = "";

        // Error management and display.
        if (wordlength <= 0) {
          setError("icon/error.svg", "red", "Error:", [
            "• The selected word length is invalid.",
          ]);
          setPassword(1, "red", "Generated Password");
          setHash("red", null);
          return;
        }

        // Password generation.
        for (let i = 0; i < wordlength; i++) {
          let word = randChoice(wordlist);
          // Apply modifiers
          if (toggleLeet.checked) {
            word = word
              .replace("o", "0")
              .replace("e", "3")
              .replace("a", "4")
              .replace("s", "5");
          }
          if (toggleAllcaps.checked) {
            word = word.toUpperCase();
          }
          if (toggleCapital.checked) {
            word = word[0].toUpperCase() + word.substring(1);
          }
          // Add to the passphrase
          if (i === 0) {
            password = word;
          } else {
            password += separator + word;
          }
        }

        // Generate useful hashes
        const SHA256 = await hash("SHA-256", password);
        const SHA512 = await hash("SHA-512", password);

        // Warning management.
        let description = [];
        // Check strength & safety
        if (checkEntropy(password) < 69) {
          description.push("• Password strength: Low.");
        } else {
          // Check the API only when the entropy is high enough to
          // avoid sending too many queries to ihavebeenpwned
          if ((await checkPasswordCompromised(password)) > 0) {
            description.push("• This password has been found in a breach.");
          }
        }

        // Password display.
        if (description.length) {
          setError("icon/warning.svg", "yellow", "Warning:", description);
          setPassword(description.length, "yellow", password);
          setHash("yellow", ["SHA-256: " + SHA256, "SHA-512: " + SHA512]);
        } else {
          setError("icon/success.svg", "green", "Password generated.", [
            "• Password strength: High.",
            "• No breaches found.",
          ]);
          setPassword("0", "blue", password);
          setHash("blue", ["SHA-256: " + SHA256, "SHA-512: " + SHA512]);
        }
      }
    </script>
  </body>
</html>
